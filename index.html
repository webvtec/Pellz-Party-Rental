<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rental Booking</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .product { border: 1px solid #ddd; border-radius: 8px; padding: 10px; text-align: center; margin: 10px; }
    .product img { max-width: 100%; border-radius: 6px; }
    .product-price { font-weight: bold; margin: 5px 0; }
    .cart-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
    .cart-content { background: #fff; padding: 20px; border-radius: 10px; width: 400px; max-height: 80%; overflow-y: auto; }
    .cart-item { display: flex; justify-content: space-between; margin: 5px 0; }
    .payment-button { padding: 10px 20px; background: #007bff; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
    .payment-button:hover { background: #0056b3; }
  </style>
</head>
<body>

  <h2 style="text-align:center;">Rental Shop</h2>
  <div id="gallery" style="display:flex; flex-wrap:wrap; justify-content:center;"></div>

  <!-- Cart Modal -->
  <div id="cartModal" class="cart-modal">
    <div class="cart-content">
      <h3>Your Cart</h3>
      <div id="cartItems"></div>
      <p id="cartTotal"><b>Total:</b> J$0</p>
      <div id="cartButtons" style="text-align:center; margin-top:15px;">
        <button id="payNowBtn" class="payment-button">PAY NOW</button>
      </div>
      <button onclick="closeCart()">Close</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

  <script>
    // Sample products
    const products = [
      { id: 1, name: "Tent", price: 5000, image: "https://via.placeholder.com/150" },
      { id: 2, name: "Chair", price: 1200, image: "https://via.placeholder.com/150" },
      { id: 3, name: "Table", price: 2500, image: "https://via.placeholder.com/150" }
    ];

    // Display gallery
    function loadGallery() {
      const gallery = document.getElementById('gallery');
      gallery.innerHTML = '';
      products.forEach(p => {
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
          <img src="${p.image}" alt="${p.name}">
          <h4>${p.name}</h4>
          <p class="product-price">J$${p.price}</p>
          <button onclick="addToCart(${p.id})">Add to Cart</button>
        `;
        gallery.appendChild(div);
      });
    }

    // Cart handling
    function addToCart(id) {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      const product = products.find(p => p.id === id);
      const existing = cart.find(i => i.id === id);
      if (existing) {
        existing.quantity += 1;
      } else {
        cart.push({ ...product, quantity: 1 });
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      viewCart();
    }

    function viewCart() {
      const modal = document.getElementById('cartModal');
      const cartItems = document.getElementById('cartItems');
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      let total = 0;
      cartItems.innerHTML = '';
      cart.forEach(item => {
        total += item.price * item.quantity;
        cartItems.innerHTML += `<div class="cart-item">${item.name} x${item.quantity} <b>J$${item.price * item.quantity}</b></div>`;
      });
      document.getElementById('cartTotal').innerHTML = `<b>Total:</b> J$${total}`;
      modal.style.display = 'flex';
    }

    function closeCart() {
      document.getElementById('cartModal').style.display = 'none';
    }

    // Handle PAY NOW
    document.addEventListener("DOMContentLoaded", () => {
      loadGallery();

      document.getElementById("payNowBtn").addEventListener("click", function () {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        if (cart.length === 0) {
          Swal.fire("Empty Cart", "Please add items before proceeding.", "error");
          return;
        }

        let total = 0;
        let itemsSummary = '';
        cart.forEach(item => {
          total += item.price * item.quantity;
          itemsSummary += `${item.name} x${item.quantity} - J$${item.price * item.quantity}\n`;
        });

        Swal.fire({
          title: "Complete Your Payment",
          html: `
            <p><b>Total:</b> J$${total.toLocaleString()}</p>
            <p>Please transfer funds to:</p>
            <p>
              <b>Bank:</b> YOUR BANK NAME<br>
              <b>Account Name:</b> YOUR ACCOUNT NAME<br>
              <b>Account Number:</b> YOUR ACCOUNT #<br>
              <b>Type:</b> Savings / Chequing
            </p>
            <p>After sending, click confirm to place your order.</p>
          `,
          showCancelButton: true,
          confirmButtonText: "Confirm Order",
          cancelButtonText: "Cancel"
        }).then(result => {
          if (result.isConfirmed) {
            sendTelegramMessage(total, itemsSummary);
            localStorage.removeItem('cart');
            Swal.fire("Success", "Your order has been placed!", "success");
            closeCart();
          }
        });
      });
    });

    // Telegram order
    function sendTelegramMessage(total, itemsSummary) {
      const name = "Customer"; // You can collect this with a form
      const phone = "000-0000";
      const location = "Kingston";

      const message = `
üõí New Reservation

üë§ Name: ${name}
üìû Phone: ${phone}
üìç Location: ${location}

üí∞ Total: J$${total}

üßæ Cart Items:
${itemsSummary}
      `;

      const telegramBotToken = "YOUR_TELEGRAM_BOT_TOKEN";
      const chatId = "YOUR_CHAT_ID";
      fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: chatId, text: message })
      });
    }
  </script>
</body>
</html>
