<!DOCTYPE html>
<html lang="en">
<head>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>ADMIN DASHBOARD</title>
<link href="https://fonts.googleapis.com/css2?family=Zilla+Slab:wght@400;700&display=swap" rel="stylesheet"/>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<style>
  body { font-family: 'Zilla Slab', serif; margin:0; background:#f4f4f4; }
  .header-bar { background:#FFD1DC; padding:16px; text-align:center; font-size:2rem; font-weight:bold; color:#6200ea; }
  .top-menu { display:flex; justify-content:space-between; flex-wrap:wrap; background:#6200ea; padding:10px; }
  .top-menu button { flex:1; margin:5px; padding:12px; border:none; border-radius:5px; background:#fff; color:#6200ea; font-weight:bold; cursor:pointer; }
  .top-menu button:hover { background:#FFD1DC; }
  .admin-container { max-width:1100px; margin:20px auto; padding:20px; background:#fff; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
  h2 { color:#6200ea; text-align:center; margin-bottom:20px; }
  .content-section { display:none; }
  .content-section.active { display:block; }
  .reservation-card { background:#fff; border:1px solid #ddd; border-radius:10px; padding:15px; margin:12px 0; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
  .reservation-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
  .reservation-header h3 { margin:0; color:#6200ea; }
  .badge { padding:4px 10px; border-radius:20px; font-size:0.8rem; font-weight:bold; color:#fff; }
  .badge.today { background:#28a745; }
  .badge.upcoming { background:#007bff; }
  .clear-container { text-align:center; margin-top:20px; }
  .clear-container input { padding:10px; margin-right:10px; border:1px solid #ccc; border-radius:5px; }
  #searchBar { width:100%; padding:10px; margin-bottom:15px; border:1px solid #ccc; border-radius:5px; font-size:1rem; }
</style>
</head>
<body>
<div class="header-bar">ADMIN DASHBOARD</div>
<div class="top-menu">
  <button onclick="showSection('gallerySection')">GALLERY</button>
  <button onclick="showSection('reservationsPage')">RESERVATIONS</button>
  <button onclick="showSection('unavailableDaysSection')">UNAVAILABLE DAYS</button>
</div>

<!-- Gallery Management Page -->
<div class="admin-container content-section" id="gallerySection">
  <div class="add-slot-container">
    <button class="add-slot-btn" onclick="addNewSlot()">âž• Add New Slot</button>
  </div>
  <div id="adminGallery"></div>
</div>

<!-- Reservations Page -->
<div class="admin-container content-section" id="reservationsPage">
  <h2>Reservations</h2>
  <input type="text" id="searchBar" placeholder="Search by name, phone, or order number..." onkeyup="filterReservations()"/>
  <div id="reservationsList"></div>
  <div class="clear-container">
    <input id="clearInput" type="text" placeholder='Type "CONFIRM" to clear past reservations'/>
    <button onclick="clearReservations()">Clear Old Reservations</button>
  </div>
</div>

<!-- Unavailable Days Page -->
<div class="admin-container content-section" id="unavailableDaysSection">
  <h2>Set Unavailable Days</h2>
  <input id="unavailableDateInput" type="date"/>
  <label><input checked id="allDayCheckbox" onchange="toggleTimeInputs()" type="checkbox"/> All Day</label>
  <div id="timeInputs" style="display:none;">
    <label>FROM:</label><input id="startTimeInput" type="time"/>
    <label>UNTIL:</label><input id="endTimeInput" type="time"/>
  </div>
  <button onclick="addUnavailableDate()">Add Unavailable Date</button>
  <h3>Unavailable Dates</h3>
  <ul id="unavailableDatesList"></ul>
</div>

<script>
const firebaseConfig = { apiKey:"AIzaSyDccI-TdbCXAJr6CD77X4yOUOfezef7Oks", authDomain:"delivery-login-3a084.firebaseapp.com", projectId:"delivery-login-3a084", storageBucket:"delivery-login-3a084.firebasestorage.app", messagingSenderId:"201998621677", appId:"1:201998621677:web:b51c3aeb2debe18b4aa5e4" };
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
let allReservations = [];

function showSection(sectionId){ document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active')); document.getElementById(sectionId).classList.add('active'); }

function loadReservations(){
  const reservationsContainer=document.getElementById('reservationsList');
  reservationsContainer.innerHTML='Loading...';
  db.collection('reservations').orderBy('createdAt','desc').onSnapshot(snapshot=>{
    reservationsContainer.innerHTML='';
    allReservations=[];
    if(snapshot.empty){ reservationsContainer.innerHTML='<p>No reservations found.</p>'; return; }
    snapshot.forEach(doc=>{
      const r=doc.data();
      allReservations.push({id:doc.id, ...r});
    });
    renderReservations(allReservations);
  });
}

function renderReservations(data){
  const container=document.getElementById('reservationsList');
  container.innerHTML='';
  data.forEach(r=>{
    const dateRange=r.rentalDates||'';
    const timeRange=(r.startTime||'')+' - '+(r.endTime||'');
    const createdAt=r.createdAt?.toDate? r.createdAt.toDate().toLocaleString() : '';
    const items=(r.cartItems||[]).map(i=>`${i.name} x${i.quantity}`).join(', ');
    container.innerHTML+=`
      <div class='reservation-card'>
        <div class='reservation-header'>
          <h3>${r.name||'No Name'} (Order #${r.orderNumber||r.id})</h3>
          <span class='badge upcoming'>Order</span>
        </div>
        <p><strong>Phone:</strong> ${r.phone||''}</p>
        <p><strong>Location:</strong> ${r.location||''}</p>
        <p><strong>Dates:</strong> ${dateRange}</p>
        <p><strong>Time:</strong> ${timeRange}</p>
        <p><strong>Items:</strong> ${items}</p>
        <p><strong>Total:</strong> ${r.totalAmount||''}</p>
        <p><em>Booked On:</em> ${createdAt}</p>
      </div>`;
  });
}

function filterReservations(){
  const query=document.getElementById('searchBar').value.toLowerCase();
  const filtered=allReservations.filter(r=>(r.name||'').toLowerCase().includes(query)||(r.phone||'').toLowerCase().includes(query)||(r.orderNumber||'').toLowerCase().includes(query));
  renderReservations(filtered);
}

firebase.auth().onAuthStateChanged(user=>{ if(user){ showSection('reservationsPage'); loadReservations(); } else { window.location.href='index.html'; } });
</script>
</body>
</html>